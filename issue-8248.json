{"source": "https://github.com/QuantConnect/Lean", "title": "NullReferenceException in ScanPastConsolidators ", "link": "https://github.com/QuantConnect/Lean/issues/8248", "state": "open", "created_by": "AlexCatarino", "created_at": "2024-08-09T13:13:29Z", "updated_at": "2024-08-13T17:13:32Z", "closed_at": null, "body": "#### Expected Behavior\r\nLEAN doesn't throw unhandled exceptions, if possible.\r\n\r\n#### Actual Behavior\r\nThe error message:\r\n\r\n> 2024-08-08T17:17:31.1648326Z ERROR:: Extensions.SetRuntimeError(): Extensions.SetRuntimeError(): RuntimeError at 08/08/2024 17:17:31 UTC. Context: AlgorithmManager.Run System.NullReferenceException: Object reference not set to an instance of an object.\r\n   at QuantConnect.Data.SubscriptionManager.ScanPastConsolidators(DateTime newUtcTime, IAlgorithm algorithm) in /Common/Data/SubscriptionManager.cs:line 263\r\n   at QuantConnect.Lean.Engine.AlgorithmManager.Run(AlgorithmNodePacket job, IAlgorithm algorithm, ISynchronizer synchronizer, ITransactionHandler transactions, IResultHandler results, IRealTimeHandler realtime, ILeanManager leanManager, CancellationToken token) in /Engine/AlgorithmManager.cs:line 202\r\n   at QuantConnect.Lean.Engine.Engine.<>c__DisplayClass10_1.<Run>b__9() in /Engine/Engine.cs:line 337\r\n\r\nsuggests that `priority` is `null` at [SubscriptionManager.cs:line 263](https://github.com/QuantConnect/Lean/blob/master/Common/Data/SubscriptionManager.cs#L263):\r\n```csharp\r\nwhile (_consolidatorsSortedByScanTime.TryPeek(out _, out var priority) && priority.UtcScanTime < newUtcTime)\r\n```\r\n\r\n#### Potential Solution\r\nAdd null check:\r\n```csharp\r\nwhile (_consolidatorsSortedByScanTime.TryPeek(out _, out var priority) && priority != null && priority.UtcScanTime < newUtcTime)\r\n```\r\n\r\n#### Reproducing the Problem\r\nN/A\r\n\r\n#### System Information\r\nQuantConnect Cloud live trading.\r\n\r\n#### Checklist\r\n- [x] I have completely filled out this template\r\n- [x] I have confirmed that this issue exists on the current `master` branch\r\n- [x] I have confirmed that this is not a duplicate issue by searching [issues](https://github.com/QuantConnect/Lean/issues)\r\n- [x] I have provided detailed steps to reproduce the issue", "comments": []}