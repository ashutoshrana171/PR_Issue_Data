{"source": "https://github.com/QuantConnect/Lean", "title": "Feature 8132 implement vortex indicator", "link": "https://github.com/QuantConnect/Lean/pull/8242", "state": "open", "created_by": "keshavdalmia10", "created_at": "2024-08-02T14:30:08Z", "updated_at": "2024-08-13T19:54:29Z", "closed_at": null, "body": "<!--- Implemented Vortex Indicator-->\r\n\r\n#### Description\r\n<!--- Describe your changes in detail -->\r\nImplements Vortex Indicator #8132\r\n\r\n#### Related Issue\r\n<!--- This project only accepts pull requests related to open issues -->\r\n<!--- If suggesting a new feature or change, please discuss it in an issue first -->\r\n<!--- If fixing a bug, there should be an issue describing it with steps to reproduce -->\r\n<!--- Please link to the issue here: -->\r\n\r\n#### Motivation and Context\r\n<!--- Why is this change required? What problem does it solve? -->\r\n\r\n#### Requires Documentation Change\r\n<!--- Please indicate if these changes will require updates to documentation, and if so, specify what changes are required -->\r\n\r\n#### How Has This Been Tested?\r\n<!--- Please describe in detail how you tested your changes. -->\r\n<!--- Include details of your testing environment, and the tests you ran to -->\r\n<!--- see how your change affects other areas of the code, etc. -->\r\n\r\n#### Types of changes\r\n<!--- What types of changes does your code introduce? Put an `x` in all the boxes that apply: -->\r\n- [ ] Bug fix (non-breaking change which fixes an issue)\r\n- [ ] Refactor (non-breaking change which improves implementation)\r\n- [ ] Performance (non-breaking change which improves performance. Please add associated performance test and results)\r\n- [x] New feature (non-breaking change which adds functionality)\r\n- [ ] Breaking change (fix or feature that would cause existing functionality to change)\r\n- [ ] Non-functional change (xml comments/documentation/etc)\r\n\r\n#### Checklist:\r\n<!--- The following is a checklist of items that MUST be completed before a PR is accepted -->\r\n<!--- If you're unsure about any of these, don't hesitate to ask. We're here to help! -->\r\n- [x] My code follows the code style of this project.\r\n- [x] I have read the **CONTRIBUTING** [document](https://github.com/QuantConnect/Lean/blob/master/CONTRIBUTING.md).\r\n- [x] I have added tests to cover my changes. <!--- If not applicable, please explain why -->\r\n- [x] All new and existing tests passed.\r\n- [x] My branch follows the naming convention `bug-<issue#>-<description>` or `feature-<issue#>-<description>`\r\n\r\n<!--- Template inspired by https://www.talater.com/open-source-templates/#/page/99 -->\r\n", "comments": [{"user": "keshavdalmia10", "is_staff": false, "created_at": "2024-08-06T20:14:02Z", "body": "Sure, @jhonabreul will work on it. Thanks for the review\r\n"}, {"user": "keshavdalmia10", "is_staff": false, "created_at": "2024-08-12T16:22:05Z", "body": "Hi @jhonabreul , @Martin-Molinero i have made changes as told, please review the pull request. Thanks."}, {"user": "keshavdalmia10", "is_staff": false, "created_at": "2024-08-12T19:54:18Z", "body": "Thanks @jhonabreul for your comments. Will work on it."}, {"user": "keshavdalmia10", "is_staff": false, "created_at": "2024-08-13T17:27:21Z", "body": "```using System;\r\nusing QuantConnect.Data.Market;\r\nusing QuantConnect.Indicators;\r\nusing System.Collections.Generic;\r\n\r\nnamespace QuantConnect.Indicators\r\n{\r\n    public class Vortex : BarIndicator, IIndicatorWarmUpPeriodProvider\r\n    {\r\n        private readonly int _period;\r\n        private readonly AverageTrueRange _atr;\r\n        private readonly IndicatorBase<IndicatorDataPoint> _atrSum;\r\n        private readonly Sum _plusVMSum;\r\n        private readonly Sum _minusVMSum;\r\n        private IBaseDataBar _previousInput;\r\n\r\n        public IndicatorBase<IndicatorDataPoint> PlusVI { get; private set; }\r\n        public IndicatorBase<IndicatorDataPoint> MinusVI { get; private set; }\r\n\r\n        public override bool IsReady => Samples >= _period;\r\n        public int WarmUpPeriod => _period;\r\n\r\n        public Vortex(int period)\r\n            : this($\"VTX({period})\", period)\r\n        {\r\n        }\r\n\r\n        public Vortex(string name, int period)\r\n            : base(name)\r\n        {\r\n            _period = period;\r\n            _atr = new AverageTrueRange(\"VTX_ATR_1\", 1, MovingAverageType.Simple);\r\n            _atrSum = new Sum(\"ATR_SUM\", period).Of(_atr);\r\n\r\n            _plusVMSum = new Sum(\"PlusVM_SUM\", period);\r\n            _minusVMSum = new Sum(\"MinusVM_SUM\", period);\r\n\r\n            PlusVI = _plusVMSum.Over(_atrSum, \"PlusVI\");\r\n            MinusVI = _minusVMSum.Over(_atrSum, \"MinusVI\");\r\n        }\r\n\r\n        protected override decimal ComputeNextValue(IBaseDataBar input)\r\n        {\r\n            if (_previousInput != null)\r\n            {\r\n                var plusVMValue = Math.Abs(input.High - _previousInput.Low);\r\n                var minusVMValue = Math.Abs(input.Low - _previousInput.High);\r\n\r\n                _plusVMSum.Update(input.Time, plusVMValue);\r\n                _minusVMSum.Update(input.Time, minusVMValue);\r\n            }\r\n\r\n            _previousInput = input;\r\n            _atr.Update(input);\r\n\r\n            return (PlusVI.Current.Value + MinusVI.Current.Value) / 2;\r\n        }\r\n\r\n        public override void Reset()\r\n        {\r\n            base.Reset();\r\n            _plusVMSum.Reset();\r\n            _minusVMSum.Reset();\r\n            _atr.Reset();\r\n            _atrSum.Reset();\r\n            PlusVI.Reset();\r\n            MinusVI.Reset();\r\n            _previousInput = null;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nI have written the above the code, but i am getting the following result from the test. I had tried a lot but could not figure out why is there a difference:\r\n\r\n Expected: 1.2301626416954157d +/- 0.0001d\r\n  But was:  1.2005772005772006d\r\n  Off by:   0.029585441118215039d\r\n  \r\n  Please can you help me with it. I am very close. @jhonabreul \r\n\r\n"}, {"user": "keshavdalmia10", "is_staff": false, "created_at": "2024-08-13T17:59:11Z", "body": "Hi @jhonabreul , made few changes in the code now all the tests are passing!!\r\n"}, {"user": "keshavdalmia10", "is_staff": false, "created_at": "2024-08-13T19:54:28Z", "body": "Hi @jhonabreul , is it ready to be merged now?"}]}