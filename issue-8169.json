{"source": "https://github.com/QuantConnect/Lean", "title": "DonchianChannel tests don't catch errors with Donchian Channels 50 Mean", "link": "https://github.com/QuantConnect/Lean/issues/8169", "state": "open", "created_by": "femtotrader", "created_at": "2024-07-07T12:49:42Z", "updated_at": "2024-07-13T14:16:20Z", "closed_at": null, "body": "<!--- This template provides sections for bugs and features. Please delete any irrelevant sections before submitting -->\r\n\r\n#### Expected Behavior\r\n<!--- Required. Describe the behavior you expect to see for your case. -->\r\n\r\nIf calculated mean value is different from \"Donchian Channels 50 Mean\" column value from spy_with_don50.txt file, test ComparesAgainstExternalData should fail which is not the case currently.\r\n\r\n#### Actual Behavior\r\n<!--- Required. Describe the actual behavior for your case. -->\r\n\r\nChange values in spy_with_don50.txt file from\r\n\r\n```\r\nDate,Open,High,Low,Close,Donchian Channels 50 Top,Donchian Channels 50 Bottom,Donchian Channels 50 Mean\r\n3/15/2013 12:00:00 AM,155.85,156.04,155.31,155.83,156.04,155.31,155.675\r\n```\r\n\r\nto\r\n\r\n```\r\nDate,Open,High,Low,Close,Donchian Channels 50 Top,Donchian Channels 50 Bottom,Donchian Channels 50 Mean\r\n3/15/2013 12:00:00 AM,155.85,156.04,155.31,155.83,156.04,155.31,999155.675\r\n```\r\n\r\nrun DonchianChannelTests... it should fail... but doesn't\r\n\r\n#### Potential Solution\r\n<!--- Optional. Describe any potential solutions and/or thoughts as to what may be causing the difference between expected and actual behavior. -->\r\n\r\nConsider something like #8162 for indicators with several outputs ie give an array of columns to read (from reference data) and an array of assertion functions.\r\n\r\n#### Reproducing the Problem\r\n<!--- Required for Bugs. Describe how to reproduce the problem. This can be via a failing unit test or a simplified algorithm that reliably demonstrates this issue.  -->\r\n\r\nsee previously\r\n\r\n#### System Information\r\n<!--- Required for Bugs. Include any system specific information, such as OS. -->\r\n\r\n#### Checklist\r\n<!--- Confirm that you've provided all the required information. -->\r\n<!--- Required fields --->\r\n- [x] I have completely filled out this template\r\n- [x] I have confirmed that this issue exists on the current `master` branch\r\n- [x] I have confirmed that this is not a duplicate issue by searching [issues](https://github.com/QuantConnect/Lean/issues)\r\n<!--- Required for Bugs, feature request can delete the line below. -->\r\n- [x] I have provided detailed steps to reproduce the issue\r\n\r\n<!--- Template inspired by https://github.com/stevemao/github-issue-templates -->", "comments": [{"user": "femtotrader", "is_staff": false, "created_at": "2024-07-13T14:16:19Z", "body": "Modifying data after 50th row and tests are failing (as they should) so it seems that comparison between expected value and indicator value only occurs when indicator is ready and fully initialized.\r\nThis indicator ouput values even after only 1 incoming bar input but it's not fully initialized nor ready (quite similar to TrueRange).\r\n\r\nSo what are consequences of this testing implementation?\r\n\r\nAn indicator which can give output after one bar can output incorrect values while it's not considered as Ready wuthout tests being able to catch that. Bug or feature? \ud83d\ude09 "}]}