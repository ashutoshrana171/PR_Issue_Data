{"source": "https://github.com/QuantConnect/Lean", "title": "Missing Automatic Exercise", "link": "https://github.com/QuantConnect/Lean/issues/8152", "state": "open", "created_by": "AlexCatarino", "created_at": "2024-07-05T14:33:53Z", "updated_at": "2024-07-05T14:33:54Z", "closed_at": null, "body": "#### Expected Behavior\r\nLEAN provides an order event for every expiration.\r\n\r\n#### Actual Behavior\r\nWhen a leg of Bull Put Spread is assigned earlier, we don't get the assignment/exercise of the other leg because of buying power.\r\n\r\n#### Potential Solution\r\nN/A\r\n\r\n#### Reproducing the Problem\r\n\r\n```csharp\r\nnamespace QuantConnect.Algorithm.CSharp {    \r\n    public class LogicalBlueLemur : QCAlgorithm {\r\n        private Symbol _spxw;\r\n\r\n        private bool _done;\r\n\r\n        public override void Initialize() {\r\n            SetStartDate(2022, 1, 21);\r\n            SetEndDate(2022, 1, 26);\r\n            SetCash(10000);\r\n            var option = AddIndexOption(AddIndex(\"SPX\").Symbol, \"SPXW\");\r\n            option.SetFilter((x) => x.IncludeWeeklys().Strikes(-5, 5).Expiration(1, 4));\r\n            _spxw = option.Symbol;\r\n        }\r\n\r\n        public override void OnData(Slice slice) {            \r\n            if (_done) return;\r\n            Buy(OptionStrategies.BullPutSpread(_spxw, 4490, 4485, new DateTime(2022, 1, 24)), 1);\r\n            _done = true;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nWhen we replace the starting cash from 10,000 to 20,000, the 4th order is recorded.\r\n\r\n#### Checklist\r\n- [x] I have completely filled out this template\r\n- [x] I have confirmed that this issue exists on the current `master` branch\r\n- [x] I have confirmed that this is not a duplicate issue by searching [issues](https://github.com/QuantConnect/Lean/issues)\r\n- [x] I have provided detailed steps to reproduce the issue", "comments": []}